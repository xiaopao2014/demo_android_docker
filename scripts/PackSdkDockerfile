FROM openjdk:8
LABEL maintainer = "linliangbin"

LABEL version = "1.0"

LABEL description = "
This is a docker image for build android application which include: 
1.AndroidSDK
2.AndroidNDK
3.Gradle 5.4.1

"

# DOWNLOAD NDK

ENV SDK_URL="https://dl.google.com/android/repository/sdk-tools-linux-3859397.zip" \
    ANDROID_HOME="/usr/local/android-sdk" \
    ANDROID_NDK="/opt/android-ndk" \
    ANDROID_VERSION=26 \
    ANDROID_BUILD_TOOLS_VERSION=26.0.2 \
    ANDROID_NDK_VERSION="20"

# Download Android SDK
RUN mkdir "$ANDROID_HOME" .android \
    && cd "$ANDROID_HOME" \
    && curl -o sdk.zip $SDK_URL \
    && unzip sdk.zip \
    && rm sdk.zip \
    && yes | $ANDROID_HOME/tools/bin/sdkmanager --licenses \ 
    && $ANDROID_HOME/tools/bin/sdkmanager "cmake;3.6.4111459"
	

# Install Android Build Tool and Libraries
RUN $ANDROID_HOME/tools/bin/sdkmanager --update
RUN $ANDROID_HOME/tools/bin/sdkmanager "build-tools;${ANDROID_BUILD_TOOLS_VERSION}" \
    "platforms;android-${ANDROID_VERSION}" \
    "platform-tools"


#Install Make
RUN apt-get install make

# Download NDK
RUN wget -q --output-document=android-ndk.zip https://dl.google.com/android/repository/android-ndk-r19c-linux-x86_64.zip && \
	unzip android-ndk.zip && \
	rm -f android-ndk.zip && \
	mv android-ndk-r19c android-ndk-linux

ENV GRADLE_HOME=~/.gradle \
	GRADLE_DISTRIBUTION_PATH= wrapper/dists \
    GRADLE_VERSION=gradle-5.4.1-all \
	GRADLE_DOWNLOAD_URL=https://services.gradle.org/distributions/${GRADLE_VERSION}.zip
	
RUN set -o errexit -o nounset \
	&& cd "${GRADLE_HOME}/${GRADLE_DISTRIBUTION_PATH}" \
	&& pwd \
	&& export GRADLE_MD5 = $GRADLE_DOWNLOAD_URL | md5sum \
	&& echo $GRADLE_MD5 \
	&& mkdir $GRADLE_MD5 \
	&& cd $GRADLE_MD5 \
    && echo "Downloading Gradle" \
    && wget --no-verbose --output-document=gradle.zip $GRADLE_DOWNLOAD_URL \
    && echo "Installing Gradle" \
    && unzip gradle.zip \
    && ln --symbolic "${GRADLE_HOME}/bin/gradle" /usr/bin/gradle \
    && echo "Testing Gradle installation" \
    && gradle --version



RUN mkdir /application
WORKDIR /application
